;
; experiment4.asm
;
; Created: 06/11/2024 09:55:26
; Author : ArthurLBDS
;


.ORG 0x00
	JMP INIT
.ORG 0x02
	JMP PRESSED_INCREASE
.ORG 0x04
	JMP PRESSED_DECREASE

.EQU DIPSWITCH_PORT = PORTD
.EQU DIPSWITCH_DDR = DDRD
.EQU BUTTON_INCREASE_PORT = SW0
.EQU BUTTON_DECREASE = SW1

INIT:
LDI R16, 0
OUT DIPSWITCH_DDR, R16
OUT 
LDI R20, HIGH(RAMEND)
OUT SPH, R20
LDI R20, LOW(RAMEND)
OUT SPL, R20   ; Initialize stack
LDI R20, 1
OUT DDRC, R20  ; PORTC as output
LDI R20, 0xF2
STS OCR0A, R20
LDI R20, 0
STS  TCCR1A, R20  ; fast PWM mode
LDI R20, (1<<WGM2)|(1<<CS0)
STS TCCR0B, R20  ; Prescaler of 1


LDI R20, (1<<OCIE1A)
STS TIMSK1, R20   ; enable Timer1 compare match interrupt
SEI               ; set Interrupt

MAIN:

SBIS DIPSWITCH_PORT, 0
rjmp main
SBS TCCR0B, 0
JMP MAIN

T1_OVERFLOW_INTERRUPT:
IN R16, PORTC    ; Read PORTc
LDI R17, 1
EOR R16, R17     ; Toggle PC0
OUT PORTC, R16
LDI R20, 0x40
STS TCNT1L, R20
LDI R20, 0xF0
STS TCNT1H, R20
RETI

/*
INTERRUPT_INCREASE:

RETI

INTERRUPT_DECREASE:

RETI
*/